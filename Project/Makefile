#---------------------------------Project---------------------------------#

Syf: codea.vbe \
     codej.vbe \
     codem.vbe \
     codeo.vbe \
     coder.vbe 
	     @echo "<-- Generated SYF"

Boom:codea_b.vbe \
     codej_b.vbe \
     codem_b.vbe \
     codeo_b.vbe \
     coder_b.vbe 
	     @echo "<-- Generated BOOM"
		 
Boog:codea_b.vst \
     codej_b.vst \
     codem_b.vst \
     codeo_b.vst \
     coder_b.vst 
	     @echo "<-- Generated BOOG"
		 
Loon:codea_b_l.vst \
     codej_b_l.vst \
     codem_b_l.vst \
     codeo_b_l.vst \
     coder_b_l.vst 
	     @echo "<-- Generated LOON"
		 
flatbeh:codem_b_l_net.vbe
	     @echo "<-- Generated FLATBEH and PROOF"
		 
dft:codem_dft.vst
	     @echo "<-- Generated DFT"
		 
 ocp:codem_p.ap
	     @echo "<-- Generated OCP"
		 
 nero:codem_dft.ap
	     @echo "<-- Generated NERO"
		 
 cougar:codem_dft.al
	     @echo "<-- Generated COUGAR"
		 
 druc:druc_core
	     @echo "<-- Generated DRC"
		 
 s2r:codem_dft.cif
	     @echo "<-- Generated SYMBOLIC TO REAL"

		 
#-----------------Finite State Machine Synthesis-----------------#

vhd_to_fsm:
	rename .vhd .fsm *.vhd

codea.vbe: code.fsm
	@echo "    Encoding Synthesis -> codea.vbe"
	syf -CEV -a code
 
codej.vbe: code.fsm
	@echo "    Encoding Synthesis  -> codej.vbe"
	syf -CEV -j code
 
codem.vbe: code.fsm
	@echo "    Encoding Synthesis  -> codem.vbe"
	syf -CEV -m code
 
codeo.vbe: code.fsm
	@echo "    Encoding Synthesis  -> codeo.vbe"
	syf -CEV -o code
 
coder.vbe: code.fsm
	@echo "    Encoding Synthesis  -> coder.vbe"
	syf -CEV -r code
	
%_b.vbe: %.vbe
	@echo "    Boolean Optimization  -> $@"
	boom -V -d 50 $* $*_b>$*_boom.out
	
%.vst: %.vbe paramfile.lax
	@echo "    Logical Synthesis  -> $@"
	boog -x 1 -l paramfile $* > $*_boog.out
	
%_l.vst: %.vst paramfile.lax
	@echo "    Netlist Optimization  -> $@"
	loon -x 1 -l paramfile $* $*_l > $*_loon.out
	
%_b_l_net.vbe: %_b_l.vst %.vbe
	@echo "    Formal Checking  -> $@"
	flatbeh $*_b_l $*_b_l_net > $*_flatbeh.out
	proof -d $* $*_b_l_net > $*_proof.out
	
codem_dft.vst: codem_b_l.vst codem_dft.vst
	@echo "    DFT  -> $@"
	scapin -VRB codem_b_l path codem_dft> codem_DFT.out
	
codem_p.ap: pin.ioc codem_dft.vst
	MBK_IN_LO=vst; export MBK_IN_LO; \
	MBK_OUT_PH=ap; export MBK_OUT_PH; \
	ocp -v -ring -ioc pin codem_dft codem_p>ocp.out
	
codem_dft.ap: codem_p.ap codem_dft.vst
	nero -V -p codem_p codem_dft codem_dft > nero.out
	
%.al: %.ap
	MBK_OUT_LO=al; export MBK_OUT_LO; \
	RDS_TECHNO_NAME=./techno/techno-035.rds; \
	export RDS_TECHNO_NAME; \
	cougar -v $* > cougar_$*.out
	lvx vst al $* $* -f > lvx_$*.out
	
druc_core:codem_dft.ap
	RDS_TECHNO_NAME=./techno/techno-symb.rds; \
	export RDS_TECHNO_NAME; \
	druc codem_dft > druc_core.out
	
codem_dft.cif: codem_dft.ap
	RDS_TECHNO_NAME=./techno/techno-035.rds; \
	export RDS_TECHNO_NAME; \
	RDS_OUT=cif; export RDS_OUT; \
	s2r -v -r codem_dft codem_dft > s2r.out
	
	

#---------------------------------Clean Up---------------------------------#

clean :
	rm -f  *.vbe *.enc *~
	@echo "Erase all the files generated by the makefile"

